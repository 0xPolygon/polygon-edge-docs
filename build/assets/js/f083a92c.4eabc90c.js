(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{100:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return h}));var o=n(0),a=n.n(o);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),p=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},b=function(e){var t=p(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},u=a.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),b=p(n),u=o,h=b["".concat(i,".").concat(u)]||b[u]||d[u]||r;return n?a.a.createElement(h,s(s({ref:t},l),{},{components:n})):a.a.createElement(h,s({ref:t},l))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},95:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var o=n(3),a=n(7),r=(n(0),n(100)),i={id:"howto-set-ibft",title:"How to set up IBFT"},s={unversionedId:"how-tos/howto-set-ibft",id:"how-tos/howto-set-ibft",isDocsHomePage:!1,title:"How to set up IBFT",description:"Useful information",source:"@site/docs/how-tos/howto-set-ibft-on-the-cloud.md",slug:"/how-tos/howto-set-ibft",permalink:"/docs/how-tos/howto-set-ibft",editUrl:"https://github.com/0xPolygon/polygon-sdk-docs/docs/how-tos/howto-set-ibft.md",version:"current",sidebar:"develop",previous:{title:"CLI Commands",permalink:"/docs/cli-commands"},next:{title:"How to query operator information",permalink:"/docs/how-tos/howto-query-operator"}},c=[{value:"Useful information",id:"useful-information",children:[]},{value:"Step 1: Initialize data folders for IBFT",id:"step-1-initialize-data-folders-for-ibft",children:[]},{value:"Step 2: Using the clients as bootstrap nodes",id:"step-2-using-the-clients-as-bootstrap-nodes",children:[]},{value:"Step 3: Generate an IBFT genesis file with the previous accounts as validators",id:"step-3-generate-an-ibft-genesis-file-with-the-previous-accounts-as-validators",children:[]},{value:"Step 4: Run all the clients",id:"step-4-run-all-the-clients",children:[]},{value:"Step 5: Monitor node activity",id:"step-5-monitor-node-activity",children:[]},{value:"Networking on Cloud providers",id:"networking-on-cloud-providers",children:[{value:"Example",id:"example",children:[]}]}],l={toc:c};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"useful-information"},"Useful information"),Object(r.b)("p",null,"For a better understanding of some commands that will be used later on, it is recommended that you go over\nthe ",Object(r.b)("a",{parentName:"p",href:"/docs/cli-commands"},"CLI Commands"),", before diving deeper into the examples below."),Object(r.b)("p",null,"The main Polygon SDK version is located on the ",Object(r.b)("strong",{parentName:"p"},"develop")," branch, and is considered to be a stable version of the SDK,\nwhile other branches are mid-feature implementations."),Object(r.b)("p",null,"The technologies mentioned in the examples are covered in their corresponding modules in the documentation."),Object(r.b)("p",null,"The how-to guides assume you have a working installation of Golang running on your machine, with Go added to the $PATH\nvariable."),Object(r.b)("p",null,"This example will go over the basics of starting multiple nodes, and demonstrate how the nodes interact between each\nother."),Object(r.b)("h2",{id:"step-1-initialize-data-folders-for-ibft"},"Step 1: Initialize data folders for IBFT"),Object(r.b)("p",null,"In order to get up and running with IBFT, you need to initialize some data folders:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go ibft init test-chain-1\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go ibft init test-chain-2\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go ibft init test-chain-3\n")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go ibft init test-chain-4\n")),Object(r.b)("p",null,"Each of these commands will print ",Object(r.b)("a",{parentName:"p",href:"https://docs.libp2p.io/concepts/peer-id/"},"node ID"),". You will need that information for the next step."),Object(r.b)("h2",{id:"step-2-using-the-clients-as-bootstrap-nodes"},"Step 2: Using the clients as bootstrap nodes"),Object(r.b)("p",null,"To start the clients as bootstrap nodes you will need to specify their address schemes by encoding them\ninto a ",Object(r.b)("a",{parentName:"p",href:"https://docs.libp2p.io/concepts/addressing/"},"multiaddr format"),":"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/ip4/<ip_address>/tcp/<port>/p2p/<node_id>\n")),Object(r.b)("p",null,"To do so, you should specify the IP address and the port for each of the clients,\nand append the node ID (from the previous step) to it. For example:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/ip4/127.0.0.1/tcp/10001/p2p/16Uiu2HAmJxxH1tScDX2rLGSU9exnuvZKNM9SoK3v315azp68DLPW\n")),Object(r.b)("h2",{id:"step-3-generate-an-ibft-genesis-file-with-the-previous-accounts-as-validators"},"Step 3: Generate an IBFT genesis file with the previous accounts as validators"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go genesis --consensus ibft --ibft-validators-prefix-path test-chain- --bootnode /ip4/127.0.0.1/tcp/10001/p2p/<node_id_1> --bootnode /ip4/127.0.0.1/tcp/20001/p2p/<node_id_2> --bootnode /ip4/127.0.0.1/tcp/30001/p2p/<node_id_3> --bootnode /ip4/127.0.0.1/tcp/40001/p2p/<node_id_4>\n")),Object(r.b)("p",null,"What this command does:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("em",{parentName:"li"},"consensus")," flag sets the consensus to IBFT"),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("em",{parentName:"li"},"--ibft-validators-prefix-path")," sets the prefix folder path to the one specified which IBFT in Polygon SDK can\nuse. This directory is used to house the ",Object(r.b)("strong",{parentName:"li"},"consensus")," folder, where the validator's private key is kept. The\nvalidator's PK is needed in order to build the genesis file - the initial list of bootstrap nodes."),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("em",{parentName:"li"},"--bootnode")," sets the bootnodes addresses that will be used to allow a new node to discover other nodes in the network through them.\nSince we are starting a new network, and it only consists of these nodes, we enter their ",Object(r.b)("inlineCode",{parentName:"li"},"multiaddr")," addresses.")),Object(r.b)("h2",{id:"step-4-run-all-the-clients"},"Step 4: Run all the clients"),Object(r.b)("p",null,"To run the ",Object(r.b)("strong",{parentName:"p"},"first")," client:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go server --data-dir ./test-chain-1 --chain genesis.json --grpc :10000 --libp2p :10001 --jsonrpc :10002 --seal\n")),Object(r.b)("p",null,"To run the ",Object(r.b)("strong",{parentName:"p"},"second")," client:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go server --data-dir ./test-chain-2 --chain genesis.json --grpc :20000 --libp2p :20001 --jsonrpc :20002 --seal\n")),Object(r.b)("p",null,"To run the ",Object(r.b)("strong",{parentName:"p"},"third")," client:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go server --data-dir ./test-chain-3 --chain genesis.json --grpc :30000 --libp2p :30001 --jsonrpc :30002 --seal\n")),Object(r.b)("p",null,"To run the ",Object(r.b)("strong",{parentName:"p"},"fourth")," client:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go server --data-dir ./test-chain-4 --chain genesis.json --grpc :40000 --libp2p :40001 --jsonrpc :40002 --seal\n")),Object(r.b)("p",null,"To briefly go over what has been done so far:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"The directory for the client data has been specified to be ",Object(r.b)("strong",{parentName:"li"},"./test-chain-","*")),Object(r.b)("li",{parentName:"ul"},"The GRPC server has been started on ports ",Object(r.b)("strong",{parentName:"li"},"10000"),", ",Object(r.b)("strong",{parentName:"li"},"20000"),", ",Object(r.b)("strong",{parentName:"li"},"30000")," and ",Object(r.b)("strong",{parentName:"li"},"40000"),", respectively"),Object(r.b)("li",{parentName:"ul"},"The libp2p server has been started on ports ",Object(r.b)("strong",{parentName:"li"},"10001"),", ",Object(r.b)("strong",{parentName:"li"},"20001"),", ",Object(r.b)("strong",{parentName:"li"},"30001")," and ",Object(r.b)("strong",{parentName:"li"},"40001"),", respectively"),Object(r.b)("li",{parentName:"ul"},"The JSON-RPC server has been started on ports ",Object(r.b)("strong",{parentName:"li"},"10002"),", ",Object(r.b)("strong",{parentName:"li"},"20002"),", ",Object(r.b)("strong",{parentName:"li"},"30002")," and ",Object(r.b)("strong",{parentName:"li"},"40002"),", respectively"),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("em",{parentName:"li"},"seal")," flag means that the node being started is going to participate in block sealing"),Object(r.b)("li",{parentName:"ul"},"The ",Object(r.b)("em",{parentName:"li"},"chain")," flag specifies which genesis file should be used for chain configuration")),Object(r.b)("p",null,"The structure of the genesis file is covered in the ",Object(r.b)("a",{parentName:"p",href:"/docs/cli-commands"},"CLI Commands")," section."),Object(r.b)("p",null,"After running the previous commands, you have set up a 4 client IBFT network, capable of sealing blocks and recovering\nfrom node failure."),Object(r.b)("h2",{id:"step-5-monitor-node-activity"},"Step 5: Monitor node activity"),Object(r.b)("p",null,"Now that you've set up at least 1 running client, you can monitor the information that passes through, such as forks and\nreorgs, using the ",Object(r.b)("strong",{parentName:"p"},"monitor")," command:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"go run main.go monitor --grpc-address localhost:20000\n")),Object(r.b)("p",null,"The above command will start monitoring blockchain event activity on the client that's running on port ",Object(r.b)("em",{parentName:"p"},"20000")),Object(r.b)("h2",{id:"networking-on-cloud-providers"},"Networking on Cloud providers"),Object(r.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},"Most cloud providers don't expose the IP addresses (especially public ones) as a direct network interface on your VM but rather setup an invisible NAT proxy."))),Object(r.b)("p",null,"To allow the nodes to connect to each other in this case you would need to listen on the ",Object(r.b)("inlineCode",{parentName:"p"},"0.0.0.0")," IP address to bind on all interfaces, but you would still need to specify the IP address which other nodes can use to connect to your instance. This is achieved using the ",Object(r.b)("inlineCode",{parentName:"p"},"--nat")," argument where you can specify your external IP."),Object(r.b)("h3",{id:"example"},"Example"),Object(r.b)("p",null,"The associated IP address that you wish to listen on is ",Object(r.b)("inlineCode",{parentName:"p"},"192.0.2.1"),", but it is not directly bound to any of your network interfaces."),Object(r.b)("p",null,"To allow the nodes to connect you would pass the following parameters:"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"go run main.go ... --libp2p 0.0.0.0:10001 --nat 192.0.2.1")),Object(r.b)("p",null,"This would make your node listen on all interfaces, but also make it aware that the clients are connecting to it through the specified ",Object(r.b)("inlineCode",{parentName:"p"},"--nat")," address."))}p.isMDXComponent=!0}}]);